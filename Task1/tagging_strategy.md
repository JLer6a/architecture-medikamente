# Механизм тегирования данных

## ? Цель
Внедрить единый механизм тегирования чувствительных данных, чтобы:
- разграничивать доступ (RBAC/ABAC),
- отслеживать действия в журнале,
- запускать алерты при подозрительной активности,
- выполнять выборку, фильтрацию и очистку данных по тегам.

---

## ? Категории тегов

| Тег         | Назначение                             |
|-------------|-----------------------------------------|
| `PII`       | Персональные данные                    |
| `PHI`       | Медицинская информация                 |
| `FIN`       | Финансовые данные                      |
| `SENSITIVE` | Общая чувствительная информация        |
| `INTERNAL`  | Внутренние бизнес-данные               |
| `AUDIT`     | Данные, подлежащие аудиту              |

---

## ? Где хранятся теги

- В метаданных каждой сущности (например, запись в БД, файл, объект в хранилище).
- В таблицах классификации данных (например, `data_classification_rules`).
- В Elastic, ClickHouse или Postgres — в виде отдельного поля `tag[]`.
- В журнале аудита (`audit_log`) вместе с `user_id`, `timestamp`, `action`.

---

## ?? Как применяется тегирование

### ? При доступе к данным (RBAC / ABAC):
- Политики определяют: "врач может видеть `PHI`, но не `FIN`".
- Пациент может видеть только `PII` и `PHI`, где `owner_id = current_user`.

### ? При построении логов и мониторинга:
- Все доступы к `tag:PHI` логируются.
- Запрос к `PHI` ночью или массовый доступ — триггерит алерт.

### ? При удалении данных:
- Запрос на удаление по 152-ФЗ ? теги упрощают поиск всех объектов клиента.

### ? При интеграциях (API):
- Перед отправкой в лабораторию фильтруются `PHI` и `PII`.
- Маскирование или исключение тегированных полей.

---

## ? Инструменты и реализации

| Уровень       | Примеры реализации                                      |
|---------------|---------------------------------------------------------|
| БД            | Postgres JSONB + индекс по тегам, отдельные поля `tag[]` |
| API Gateway   | Spring Cloud Gateway с проверкой тегов                  |
| Хранилище     | S3 + object tags                                        |
| Мониторинг    | Elastic / Kibana / Filebeat / Grafana / Prometheus      |
| IAM / Access  | Keycloak, Spring Security       |


