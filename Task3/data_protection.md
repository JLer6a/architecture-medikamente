# Data Encryption at Rest and In Transit

В этом документе представлена стратегия защиты данных, с учётом их состояния (at rest / in transit), чувствительности, рисков и подходящих механизмов защиты.

## Классификация данных и стратегии защиты

| Тип данных            | Где хранятся                         | Состояние       | Риск                            | Необходимость защиты      | Методы защиты |
|-----------------------|--------------------------------------|------------------|----------------------------------|----------------------------|----------------|
| PII (ФИО, email, ИНН) | CRM (Postgres), Kafka                | At Rest         | Утечка персональных данных      | Высокая                   | TDE, mask/crypto, RBAC |
| PHI (диагноз, история)| MedData (Postgres), Excel upload     | At Rest / Transit| Нарушение мед. конфиденциальности | Критическая             | TLS 1.3, FPE, шифрование колонок, JWT |
| Фин. данные (оплата)  | Finance (1С, Postgres)               | At Rest         | Подделка, утечка                | Высокая                   | HMAC, audit log, KMS |
| Файлы-анализы (JPG/PDF)| FileStorage, S3                     | At Rest         | Несанкц. доступ, модификация    | Средняя                   | S3 SSE-KMS, access logs |
| Аудит и логи          | Elastic, ClickHouse                  | At Rest         | Удаление, подмена               | Средняя                   | Append-only, RBAC, timestamping |
| API трафик            | API-GW <-> backend                   | In Transit      | MITM, подделка                  | Критическая               | mTLS, OIDC, TLS 1.3 |
| BI-данные             | Data Lake (ClickHouse, S3)           | At Rest         | Утечка обезличенных данных      | Средняя/низкая            | Tokenization, ролевой доступ |

## Инструменты защиты

### Защита данных в покое (At Rest)
- TDE (Transparent Data Encryption) — PostgreSQL, MS SQL
- Шифрование на уровне поля (FPE) — только для PHI / PII
- AWS / GCP / Azure KMS — централизованное управление ключами
- SSE-KMS — для шифрования в S3-хранилищах
- HashiCorp Vault — безопасное хранилище секретов и ключей

### Защита данных при передаче (In Transit)
- TLS 1.3 + mTLS — обязательное шифрование каналов
- JWT с claim’ами и временем жизни — для защиты доступа к API
- HSTS и CORS — защита от атак через браузер
- API Gateway / WAF — проверка входящих запросов

## Автоматизированный контроль

| Система                    | Назначение                              |
|----------------------------|------------------------------------------|
| HashiCorp Vault            | Хранение и ротация ключей               |
| Elastic + AuditLog         | Аудит действий, тегирование запросов    |
| Grafana / Prometheus / SIEM| Мониторинг, алерты, логирование         |
| OPA (Open Policy Agent)    | ABAC политики в real-time               |
| Kubernetes SealedSecrets   | Защищённое управление секретами в CI/CD |

## Вывод

Система содержит чувствительные данные (PHI, PII, финансы), которые требуют многоуровневой защиты. Предложенные инструменты реализуют контроль за данными на всех этапах: от API до хранения и аналитики.